# Architecture Diagrams

## System Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    APPLICATION LAYER                         │
│                                                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │ RAG Pipeline │  │  CLI Tools   │  │  API Server  │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
└─────────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                  HIGH-LEVEL API (model/)                     │
│                                                              │
│  ┌──────────┐  ┌──────┐  ┌───────┐  ┌──────────┐          │
│  │ Document │  │ Page │  │ Table │  │ Elements │          │
│  └──────────┘  └──────┘  └───────┘  └──────────┘          │
└─────────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│              PROCESSING LAYER                                │
│                                                              │
│  ┌─────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │   Text      │  │   Layout     │  │   Tables     │      │
│  │ Extraction  │  │   Analysis   │  │  Detection   │      │
│  └─────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│              CONTENT LAYER                                   │
│                                                              │
│  ┌──────────────┐  ┌──────────┐  ┌──────────────┐         │
│  │   Content    │  │   Font   │  │   Graphics   │         │
│  │    Stream    │  │ Handling │  │    State     │         │
│  └──────────────┘  └──────────┘  └──────────────┘         │
└─────────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                 PDF CORE (core/)                             │
│                                                              │
│  ┌────────┐  ┌───────┐  ┌────────┐  ┌──────────┐          │
│  │ Object │  │ XRef  │  │ Stream │  │ Encrypt  │          │
│  │ Parser │  │       │  │ Decode │  │          │          │
│  └────────┘  └───────┘  └────────┘  └──────────┘          │
└─────────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                      I/O LAYER                               │
│                                                              │
│  ┌────────────┐  ┌─────────────┐  ┌────────────┐          │
│  │   File     │  │   Buffer    │  │ Compress   │          │
│  │ Reader/    │  │ Management  │  │   Codecs   │          │
│  │  Writer    │  │             │  │            │          │
│  └────────────┘  └─────────────┘  └────────────┘          │
└─────────────────────────────────────────────────────────────┘
```

## PDF File Structure

```
┌─────────────────────────────────────────────────────────────┐
│ %PDF-1.7                                    ← Header         │
│ %âãÏÓ (binary marker)                                       │
└─────────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                      BODY                                    │
│                                                              │
│  1 0 obj                                                     │
│  <</Type /Catalog /Pages 2 0 R>>                            │
│  endobj                                                      │
│                                                              │
│  2 0 obj                                                     │
│  <</Type /Pages /Kids [3 0 R] /Count 1>>                   │
│  endobj                                                      │
│                                                              │
│  3 0 obj                                                     │
│  <</Type /Page /Parent 2 0 R                                │
│    /MediaBox [0 0 612 792]                                  │
│    /Contents 4 0 R                                          │
│    /Resources <</Font <</F1 5 0 R>> >> >>                   │
│  endobj                                                      │
│                                                              │
│  4 0 obj                                                     │
│  <</Length 44>>                                             │
│  stream                                                      │
│  BT /F1 12 Tf 100 700 Td (Hello, PDF!) Tj ET               │
│  endstream                                                   │
│  endobj                                                      │
│                                                              │
│  5 0 obj                                                     │
│  <</Type /Font /Subtype /Type1 /BaseFont /Helvetica>>      │
│  endobj                                                      │
└─────────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                 CROSS-REFERENCE TABLE                        │
│                                                              │
│  xref                                                        │
│  0 6                                                         │
│  0000000000 65535 f                                         │
│  0000000015 00000 n                                         │
│  0000000074 00000 n                                         │
│  0000000133 00000 n                                         │
│  0000000251 00000 n                                         │
│  0000000345 00000 n                                         │
└─────────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                     TRAILER                                  │
│                                                              │
│  trailer                                                     │
│  <</Size 6 /Root 1 0 R>>                                    │
│  startxref                                                   │
│  408                                                         │
│  %%EOF                                                       │
└─────────────────────────────────────────────────────────────┘
```

## Object Graph

```
                    ┌───────────┐
                    │  Catalog  │
                    │  (Root)   │
                    └─────┬─────┘
                          │
                          ▼
                    ┌───────────┐
                    │   Pages   │
                    │   Tree    │
                    └─────┬─────┘
                          │
                ┌─────────┼─────────┐
                ▼         ▼         ▼
           ┌────────┐ ┌────────┐ ┌────────┐
           │ Page 1 │ │ Page 2 │ │ Page 3 │
           └───┬────┘ └───┬────┘ └───┬────┘
               │          │          │
        ┌──────┼──────┐   │   ┌──────┼──────┐
        ▼      ▼      ▼   ▼   ▼      ▼      ▼
    ┌────┐ ┌──────┐ ┌──────┐ ┌────┐ ┌────┐
    │Cont│ │Resou │ │Media │ │... │ │... │
    │ent │ │rces  │ │Box   │ │    │ │    │
    └────┘ └───┬──┘ └──────┘ └────┘ └────┘
               │
        ┌──────┴──────┐
        ▼             ▼
    ┌───────┐     ┌────────┐
    │ Fonts │     │ Images │
    └───────┘     └────────┘
```

## Content Stream Processing Flow

```
┌────────────────┐
│ Raw Content    │
│ Stream Data    │
└───────┬────────┘
        │
        ▼
┌────────────────┐
│ Decompress     │
│ (if encoded)   │
└───────┬────────┘
        │
        ▼
┌────────────────┐      ┌─────────────────┐
│ Parse          │ ──── │ Graphics State  │
│ Operators      │      │ Stack           │
└───────┬────────┘      └─────────────────┘
        │
        ├──────────┬──────────┬──────────┐
        ▼          ▼          ▼          ▼
    ┌────┐    ┌────┐    ┌────┐    ┌────┐
    │Text│    │Path│    │Img │    │Gfx │
    │Ops │    │Ops │    │Ops │    │Ops │
    └─┬──┘    └─┬──┘    └─┬──┘    └─┬──┘
      │         │         │         │
      ▼         ▼         ▼         ▼
  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐
  │ Text   │ │ Lines/ │ │ Images │ │ State  │
  │Fragmen│ │ Rects  │ │        │ │Changes │
  │  ts    │ │        │ │        │ │        │
  └────────┘ └────────┘ └────────┘ └────────┘
```

## Table Detection Pipeline

```
┌─────────────────────────────────────────────────────────┐
│              Input: Page with Text Fragments            │
│                                                          │
│  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐    │
│  │ Text │  │ Text │  │ Text │  │ Text │  │ Text │    │
│  │ Frag │  │ Frag │  │ Frag │  │ Frag │  │ Frag │    │
│  └──────┘  └──────┘  └──────┘  └──────┘  └──────┘    │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│           Step 1: Spatial Clustering                     │
│                                                          │
│  Group nearby fragments into candidate regions          │
│                                                          │
│  ┌─────────────────┐      ┌──────────────┐            │
│  │   Cluster 1     │      │  Cluster 2   │            │
│  │  (10 fragments) │      │ (6 fragments)│            │
│  └─────────────────┘      └──────────────┘            │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│           Step 2: Alignment Analysis                     │
│                                                          │
│  Detect row and column alignments                       │
│                                                          │
│  Y-coords: [700, 680, 660, 640]  ← Row boundaries      │
│  X-coords: [50, 150, 250, 350]   ← Column boundaries   │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│           Step 3: Grid Construction                      │
│                                                          │
│     Col1    Col2    Col3    Col4                        │
│   ┌───────┬───────┬───────┬───────┐                    │
│ R1│   A   │   B   │   C   │   D   │                    │
│   ├───────┼───────┼───────┼───────┤                    │
│ R2│   1   │   2   │   3   │   4   │                    │
│   ├───────┼───────┼───────┼───────┤                    │
│ R3│   α   │   β   │   γ   │   δ   │                    │
│   └───────┴───────┴───────┴───────┘                    │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│           Step 4: Cell Assignment                        │
│                                                          │
│  Assign text fragments to cells based on position       │
│                                                          │
│  Cell[0][0] ← Fragments overlapping (50,700,100,20)    │
│  Cell[0][1] ← Fragments overlapping (150,700,100,20)   │
│  ...                                                     │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│           Step 5: Validation & Scoring                   │
│                                                          │
│  Confidence = f(regularity, alignment, lines, density)  │
│                                                          │
│  Regularity:  0.85 ✓                                    │
│  Alignment:   0.92 ✓                                    │
│  Line Score:  0.78 ✓                                    │
│  Occupancy:   0.95 ✓                                    │
│  ────────────────────                                   │
│  Confidence:  0.875  (> threshold)                      │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│           Output: Structured Table                       │
│                                                          │
│  Table {                                                 │
│    Rows: 3, Cols: 4                                     │
│    Confidence: 0.875                                     │
│    HasGrid: true                                         │
│    Cells: [...]                                         │
│  }                                                       │
└─────────────────────────────────────────────────────────┘
```

## Text Extraction State Machine

```
┌─────────────┐
│   START     │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│   q/Q       │  Graphics State Operations
│   Save/     │  (maintain state stack)
│   Restore   │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│   cm/Tm     │  Transformation Matrix
│  Transform  │  (track text/graphics position)
└──────┬──────┘
       │
       ▼
┌─────────────┐
│    BT       │  Begin Text Object
│  (Begin     │  (initialize text state)
│   Text)     │
└──────┬──────┘
       │
   ┌───┴────┐
   ▼        ▼
┌─────┐  ┌──────┐
│ Tf  │  │  Tm  │  Font & Matrix Setup
│Font │  │Matrix│  (prepare for text)
└──┬──┘  └───┬──┘
   │         │
   └────┬────┘
        ▼
   ┌─────────┐
   │  Tj/TJ  │  Show Text
   │  (Text) │  (extract & position)
   └────┬────┘
        │
        ▼
   ┌─────────┐
   │   ET    │  End Text Object
   │  (End)  │  (finalize)
   └────┬────┘
        │
        ▼
   ┌─────────┐
   │   END   │
   └─────────┘
```

## Memory Architecture

```
┌────────────────────────────────────────────────────────┐
│                  Application                           │
│                                                         │
│  ┌──────────────┐                                      │
│  │   Document   │  ← High-level IR (in memory)        │
│  │    Model     │                                      │
│  └──────────────┘                                      │
└────────────────────────────────────────────────────────┘
                    ▲
                    │ (lazy load)
                    │
┌────────────────────────────────────────────────────────┐
│                 Object Cache                           │
│                                                         │
│  ┌────────┐  ┌────────┐  ┌────────┐                  │
│  │  Font  │  │ Stream │  │ Object │  ← LRU Cache     │
│  │ Cache  │  │ Cache  │  │ Cache  │                  │
│  └────────┘  └────────┘  └────────┘                  │
└────────────────────────────────────────────────────────┘
                    ▲
                    │ (on demand)
                    │
┌────────────────────────────────────────────────────────┐
│                  XRef Table                            │
│                                                         │
│  Object ID → File Offset mapping                      │
│  (small, always in memory)                             │
└────────────────────────────────────────────────────────┘
                    ▲
                    │ (indexed access)
                    │
┌────────────────────────────────────────────────────────┐
│                   PDF File                             │
│                                                         │
│  Binary data on disk (streaming I/O)                  │
└────────────────────────────────────────────────────────┘
```

## Parallel Processing Model

```
                    ┌─────────────┐
                    │   PDF File  │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │  Parse XRef │
                    │  & Catalog  │
                    └──────┬──────┘
                           │
                           ▼
              ┌────────────┴────────────┐
              │    Page References      │
              │   [1, 2, 3, ... N]      │
              └────────────┬────────────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
   ┌─────────┐        ┌─────────┐       ┌─────────┐
   │Worker 1 │        │Worker 2 │       │Worker N │
   │         │        │         │       │         │
   │ Page 1  │        │ Page 2  │       │ Page N  │
   │ Page 4  │        │ Page 5  │       │ ...     │
   │  ...    │        │  ...    │       │         │
   └────┬────┘        └────┬────┘       └────┬────┘
        │                  │                  │
        │                  │                  │
        └──────────────────┼──────────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │   Combine   │
                    │   Results   │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │  Document   │
                    └─────────────┘
```

## RAG Integration Flow

```
┌─────────────┐
│   PDF File  │
└──────┬──────┘
       │
       ▼
┌─────────────────┐
│   PDF Parser    │
│  (this library) │
└──────┬──────────┘
       │
       ▼
┌─────────────────────────────────────┐
│      Intermediate Representation    │
│                                     │
│  ┌──────┐  ┌──────┐  ┌───────┐    │
│  │ Head │  │ Para │  │ Table │    │
│  │ ing  │  │graph │  │       │    │
│  └──────┘  └──────┘  └───────┘    │
└──────┬──────────────────────────────┘
       │
       ▼
┌─────────────────┐
│  Chunking       │
│  Strategy       │
│                 │
│  • Semantic     │
│  • Fixed-size   │
│  • Hierarchical │
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│  RAG Chunks     │
│  + Metadata     │
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│  Embedding      │
│  Model          │
│  (e.g., OpenAI) │
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│  Vector Store   │
│  (Pinecone,     │
│   Weaviate,     │
│   etc.)         │
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│   Retrieval     │
│   & LLM         │
└─────────────────┘
```

These diagrams provide visual understanding of the library's architecture, data flow, and algorithms.
